<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

# SwarmTests Module

## Overview

Test suites for the Swarm framework following TDD methodology. Foundation Models are unavailable in test environments — all LLM interactions must be mocked.

## Directory Structure

```
Tests/SwarmTests/
├── Agents/           — Agent behavior tests (Agent, ReAct, PlanAndExecute)
├── Memory/           — Memory system tests (Conversation, Vector, Summary)
├── Orchestration/    — Orchestration step and compilation tests
├── Tools/            — Tool execution and registry tests
├── DSL/              — Blueprint and builder tests
└── Mocks/            — Shared mock implementations
```

## Mock Inventory

### MockInferenceProvider (`Mocks/MockInferenceProvider.swift`)
```swift
let provider = MockInferenceProvider()
provider.responses = ["First response", "Second response"]  // Consumed in order
provider.toolCallResponses = [/* InferenceResponse */]       // Structured tool calls
provider.errorToThrow = MyError.test                         // Inject errors
provider.responseDelay = .milliseconds(100)                  // Simulate latency
```
Verification: `generateCallCount`, `lastGenerateCall`, `streamCalls`

### MockTool / SpyTool / FailingTool / EchoTool (`Mocks/MockTool.swift`)
```swift
let mock = MockTool(name: "weather", result: .string("Sunny"))
let spy = SpyTool(name: "calc")      // Records all invocations
let failing = FailingTool(name: "broken")  // Always throws
let echo = EchoTool(name: "echo")    // Returns arguments
```

### MockAgentMemory (`Mocks/MockAgentMemory.swift`)
Pre-populate with messages for multi-turn testing.

### StreamHelper (in OrchestrationTests.swift)
```swift
let (stream, continuation) = StreamHelper.makeTrackedStream()
```

## Test Naming Convention

```swift
func test_[method]_[scenario]_[expectedBehavior]() async throws {
    // Given — setup
    // When — action
    // Then — assertions
}
```

## Async Testing Patterns

```swift
// Direct async
func test_behavior() async throws {
    let result = try await sut.execute(input)
    XCTAssertEqual(result.output, expected)
}

// Stream collection
func test_streamEvents() async throws {
    var events: [AgentEvent] = []
    for try await event in sut.stream(input) { events.append(event) }
    XCTAssertTrue(events.last?.isCompleted ?? false)
}
```

## Conventions
- ALWAYS mock `InferenceProvider` — Foundation Models unavailable in tests
- One test class per feature/component
- Organize with `// MARK: -` sections
- Each test tests ONE behavior
- Error paths tested as thoroughly as success paths
- No randomness in test inputs — deterministic data only
- Mock protocols follow `Mock[ProtocolName]` naming
